# AEW Fantasy League - Microservices Backend

A comprehensive fantasy wrestling league backend system built with Spring Boot microservices architecture, supporting AEW (All Elite Wrestling) events.

## üèÜ Features

- **Microservices Architecture**: 12 independent services with Spring Cloud
- **JWT Authentication**: Secure token-based authentication
- **PostgreSQL Databases**: Separate database per service
- **Redis Caching**: Session management and caching
- **Kafka Messaging**: Inter-service communication
- **Docker Support**: Full containerization with docker-compose
- **Service Discovery**: Eureka server for service registration
- **API Gateway**: Centralized routing and security

## üèóÔ∏è Architecture

### Core Services

1. **API Gateway** (Port 8080) - Centralized routing and security
2. **Eureka Server** (Port 8761) - Service discovery and registration
3. **Config Server** (Port 8888) - Centralized configuration management

### Business Services

4. **Auth Service** (Port 8081) - User authentication and JWT management
5. **User Service** (Port 8082) - User profiles and preferences
6. **Wrestler Service** (Port 8083) - AEW wrestler data management
7. **Team Service** (Port 8084) - Fantasy team management and transfers
8. **League Service** (Port 8085) - Public/private league management
9. **Match Service** (Port 8086) - AEW match results storage
10. **Scoring Service** (Port 8087) - Automatic point calculation
11. **Leaderboard Service** (Port 8088) - Standings and rankings
12. **Notification Service** (Port 8089) - Email notifications and alerts

## üéØ Scoring System

### Point Values
- **Win Match**: +5 points
- **Draw Match**: +2 points
- **Lose by DQ**: -2 points
- **Successful Title Defense**: +8 points
- **Title Win**: +10 points
- **Main Event Appearance**: +3 points
- **Promo Segment**: +3 points
- **Injury**: -5 points
- **Captain**: Double points (one per team each matchday)
- **PPV Events**: All points doubled

### Supported Events
- AEW Dynamite
- AEW Collision
- AEW Pay-Per-Views (PPVs)

## üöÄ Quick Start

### Prerequisites
- Java 17+
- Maven 3.6+
- Docker & Docker Compose
- PostgreSQL 15+
- Redis 7+
- Apache Kafka

### Using Docker Compose (Recommended)

1. **Clone and navigate to the project**:
```bash
git clone <repository-url>
cd aew-fantasy-league
```

2. **Start all services**:
```bash
docker-compose up -d
```

3. **Check service health**:
```bash
# Check Eureka dashboard
open http://localhost:8761

# Check API Gateway
open http://localhost:8080/actuator/health
```

### Manual Setup

1. **Start Infrastructure**:
```bash
# Start PostgreSQL
docker run -d --name postgres -e POSTGRES_PASSWORD=postgres -p 5432:5432 postgres:15-alpine

# Start Redis
docker run -d --name redis -p 6379:6379 redis:7-alpine

# Start Kafka (requires Zookeeper)
docker run -d --name zookeeper -p 2181:2181 confluentinc/cp-zookeeper:latest
docker run -d --name kafka -p 9092:9092 --link zookeeper confluentinc/cp-kafka:latest
```

2. **Initialize Databases**:
```bash
# Run the database initialization script
psql -h localhost -U postgres -f scripts/init-databases.sql
```

3. **Build and Run Services** (in order):
```bash
# 1. Eureka Server
cd services/eureka-server
mvn spring-boot:run

# 2. Config Server
cd services/config-server
mvn spring-boot:run

# 3. API Gateway
cd services/api-gateway
mvn spring-boot:run

# 4. Business Services (can be run in parallel)
cd services/auth-service && mvn spring-boot:run &
cd services/user-service && mvn spring-boot:run &
cd services/wrestler-service && mvn spring-boot:run &
cd services/team-service && mvn spring-boot:run &
cd services/league-service && mvn spring-boot:run &
cd services/match-service && mvn spring-boot:run &
cd services/scoring-service && mvn spring-boot:run &
cd services/leaderboard-service && mvn spring-boot:run &
cd services/notification-service && mvn spring-boot:run &
```

## üìä API Endpoints

### Authentication
- `POST /api/auth/register` - User registration
- `POST /api/auth/login` - User login
- `POST /api/auth/refresh` - Refresh JWT token

### Users
- `GET /api/users/profile` - Get user profile
- `PUT /api/users/profile` - Update user profile
- `GET /api/users/preferences` - Get user preferences

### Wrestlers
- `GET /api/wrestlers` - List all wrestlers
- `GET /api/wrestlers/{id}` - Get wrestler details
- `POST /api/wrestlers` - Create wrestler (Admin)
- `PUT /api/wrestlers/{id}` - Update wrestler (Admin)

### Teams
- `GET /api/teams` - Get user's teams
- `POST /api/teams` - Create new team
- `PUT /api/teams/{id}/roster` - Update team roster
- `POST /api/teams/{id}/transfers` - Make transfers
- `PUT /api/teams/{id}/captain` - Set team captain

### Leagues
- `GET /api/leagues` - List available leagues
- `POST /api/leagues` - Create new league
- `POST /api/leagues/{id}/join` - Join league
- `GET /api/leagues/{id}/standings` - Get league standings

### Matches
- `GET /api/matches` - List matches
- `POST /api/matches` - Add match result (Admin)
- `GET /api/matches/upcoming` - Get upcoming matches

### Scoring
- `GET /api/scoring/rules` - Get scoring rules
- `POST /api/scoring/calculate` - Calculate points for match

### Leaderboards
- `GET /api/leaderboards/weekly` - Weekly leaderboard
- `GET /api/leaderboards/season` - Season leaderboard
- `GET /api/leaderboards/league/{id}` - League-specific leaderboard

## üîß Configuration

### Environment Variables
```bash
# Database Configuration
SPRING_DATASOURCE_URL=jdbc:postgresql://localhost:5432/auth_db
SPRING_DATASOURCE_USERNAME=auth_user
SPRING_DATASOURCE_PASSWORD=auth_password

# Redis Configuration
SPRING_REDIS_HOST=localhost
SPRING_REDIS_PORT=6379

# Kafka Configuration
SPRING_KAFKA_BOOTSTRAP_SERVERS=localhost:9092

# JWT Configuration
JWT_SECRET=your-secret-key
JWT_EXPIRATION=86400000

# Mail Configuration (for notifications)
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=your-app-password
```

## üê≥ Docker Commands

```bash
# Build all services
docker-compose build

# Start all services
docker-compose up -d

# View logs
docker-compose logs -f [service-name]

# Stop all services
docker-compose down

# Stop and remove volumes
docker-compose down -v
```

## üß™ Testing

```bash
# Run tests for all services
mvn test

# Run tests for specific service
cd services/auth-service
mvn test

# Integration tests with Docker
docker-compose -f docker-compose.test.yml up --abort-on-container-exit
```

## üìà Monitoring

- **Eureka Dashboard**: http://localhost:8761
- **Service Health**: http://localhost:8080/actuator/health
- **Metrics**: http://localhost:8080/actuator/metrics

## üîí Security

- JWT-based authentication
- Role-based access control (USER, ADMIN)
- CORS configuration for frontend integration
- Input validation and sanitization
- SQL injection prevention with JPA

## üöÄ Production Deployment

1. **Build production images**:
```bash
docker-compose -f docker-compose.prod.yml build
```

2. **Deploy with Nginx**:
```bash
# Configure Nginx reverse proxy
# Update docker-compose.prod.yml with production settings
docker-compose -f docker-compose.prod.yml up -d
```

## üìù Development Notes

- Each service has its own database schema
- Flyway migrations are included for database versioning
- Kafka topics are auto-created on first message
- Redis is used for session storage and caching
- All services are stateless and horizontally scalable

## ü§ù Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests
5. Submit a pull request

## üìÑ License

This project is licensed under the MIT License - see the LICENSE file for details.
